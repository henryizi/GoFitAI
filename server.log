--- SERVER RESTARTED ---
--- Code version: 4.0.2 - Gemini-Only-Clean: AI generation with mathematical fallback ---
[VISION SERVICE] Initializing Gemini Vision Service
[AI SERVICE] Initializing Gemini Text Service with API key rotation
[GEMINI TEXT] Using key with best quota availability
[GEMINI TEXT] Service initialized with model: gemini-2.5-flash
[GEMINI TEXT] API Key rotation enabled: ‚úÖ Yes
[WORKOUT SERVICE] Initializing Gemini Workout Service
=== AI CONFIGURATION ===
Available AI Providers: [ 'gemini', 'fallback' ]
GEMINI_API_KEY exists: true
GEMINI_MODEL: gemini-2.5-flash
Using model URL: https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent
Gemini provider config: {
  name: 'gemini',
  apiKey: 'AIzaSyA4MvRwO2jzzyXC9s14GltLzpGH-A7RpRg',
  apiUrl: 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent',
  model: 'gemini-2.5-flash',
  enabled: true
}
Default AI_PROVIDER: gemini
Total providers available: 2
- gemini: ENABLED (gemini-2.5-flash)
- fallback: ENABLED (rule-based)
========================
[SERVER] Timeout configuration:
  - Request timeout: 600s
  - Keep-alive timeout: 610s
  - Headers timeout: 620s
GoFitAI Server v2.0 running on port 4000
Local IP: 192.168.0.176
Server URL: http://192.168.0.176:4000
Test API with: curl http://192.168.0.176:4000/api/test
[WORKOUT] /api/generate-workout-plan called
[WORKOUT] Generating plan with profile: {
  level: 'intermediate',
  goal: 'general_fitness',
  workoutFrequency: '4_5',
  age: 30
}
[WORKOUT] ‚ùå Gemini AI failed: (profile.full_name || "Client")(profile.gender || "Not specified")(profile.age || "Not specified")(profile.training_level || "intermediate")(profile.primary_goal || "general fitness")(intermediate value)(intermediate value)(intermediate value)(intermediate value)(intermediate value)(intermediate value)getFrequencyExplanation(...)getMinFrequency(...)getMaxFrequency(...)(intermediate value)(intermediate value)(intermediate value)(intermediate value)(intermediate value)(intermediate value) is not a function
[WORKOUT] üßÆ Using rule-based fallback workout plan generation
[WORKOUT] Generating rule-based workout plan for: general_fitness
[WORKOUT] Debug - userProfile: {
  "full_name": "Test User",
  "gender": "male",
  "age": 30,
  "training_level": "intermediate",
  "primary_goal": "general_fitness",
  "workout_frequency": "4_5"
}
[WORKOUT] Debug - preferences: {}
[WORKOUT] Debug - workoutTypes: []
[WORKOUT] Error in generateRuleBasedWorkoutPlan: Assignment to constant variable.
[WORKOUT] Error stack: TypeError: Assignment to constant variable.
    at selectExercises (/Users/ngkwanho/Desktop/GoFitAI/server/index.js:476:17)
    at generatePersonalizedExercises (/Users/ngkwanho/Desktop/GoFitAI/server/index.js:551:29)
    at generateRuleBasedWorkoutPlan (/Users/ngkwanho/Desktop/GoFitAI/server/index.js:818:20)
    at /Users/ngkwanho/Desktop/GoFitAI/server/index.js:2163:28
    at Layer.handle [as handle_request] (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/express/lib/router/layer.js:95:5)
    at next (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/express/lib/router/layer.js:95:5)
    at /Users/ngkwanho/Desktop/GoFitAI/server/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/express/lib/router/index.js:346:12)
[WORKOUT] Workout plan generation failed: Cannot read properties of null (reading 'weekly_schedule')
{"level":30,"time":1759583949814,"pid":35629,"hostname":"MacBook-Air-126.local","req":{"id":1,"method":"POST","url":"/api/generate-workout-plan","query":{},"params":{},"headers":{"host":"localhost:4000","user-agent":"curl/8.7.1","accept":"*/*","content-type":"application/json","content-length":"165"},"remoteAddress":"127.0.0.1","remotePort":52607},"res":{"statusCode":500,"headers":{"cross-origin-opener-policy":"same-origin","cross-origin-resource-policy":"same-origin","origin-agent-cluster":"?1","referrer-policy":"no-referrer","strict-transport-security":"max-age=15552000; includeSubDomains","x-content-type-options":"nosniff","x-dns-prefetch-control":"off","x-download-options":"noopen","x-frame-options":"SAMEORIGIN","x-permitted-cross-domain-policies":"none","x-xss-protection":"0","access-control-allow-origin":"*","access-control-allow-credentials":"true","access-control-expose-headers":"Content-Length,Content-Type","content-type":"application/json; charset=utf-8","content-length":"86","etag":"W/\"56-J/uX0PALXUvCj0eGa2BEp7nNnFU\""}},"err":{"type":"Error","message":"failed with status code 500","stack":"Error: failed with status code 500\n    at onResFinished (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/pino-http/logger.js:114:39)\n    at ServerResponse.onResponseComplete (/Users/ngkwanho/Desktop/GoFitAI/server/node_modules/pino-http/logger.js:177:14)\n    at ServerResponse.emit (node:events:530:35)\n    at onFinish (node:_http_outgoing:1081:10)\n    at callback (node:internal/streams/writable:766:21)\n    at afterWrite (node:internal/streams/writable:710:5)\n    at afterWriteTick (node:internal/streams/writable:696:10)\n    at process.processTicksAndRejections (node:internal/process/task_queues:89:21)"},"responseTime":9,"msg":"request errored"}
[SHUTDOWN] Received SIGTERM. Shutting down gracefully...
